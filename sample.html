<!DOCTYPE html>
<html>

<head>
  <title>Simple Camera</title>
  <script>
  navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia;
var URL = window.URL || window.webkitURL;
var RTCPeerConnection = window.RTCPeerConnection || window.webkitRTCPeerConnection || window.mozRTCPeerConnection;
var RTCSessionDescription = window.RTCSessionDescription || window.webkitRTCSessionDescription || window.mozRTCSessionDescription;
var RTCIceCandidate = window.RTCIceCandidate || window.webkitRTCIceCandidate || window.mozRTCIceCandidate;

var mediaC = {
  'mandatory': {
    'OfferToReceiveAudio': true,
    'OfferToReceiveVideo': true
  }
};
var ice_config = {
  "iceServers": []
};

function getVideoSources(callback) {
  if (!navigator.mediaDevices) {
    console.log("MediaStreamTrack");
    MediaStreamTrack.getSources(function(cams) {
      cams.forEach(function(c, i, a) {
        if (c.kind != 'video') return;
        callback({
          name: c.facing,
          id: c.id
        });
      });
    });
  } else {
    navigator.mediaDevices.enumerateDevices().then(function(cams) {
      cams.forEach(function(c, i, a) {
        console.log("mediaDevices", c);
        if (c.kind != 'videoinput') return;
        callback({
          name: c.label,
          id: c.deviceId
        });
      });
    });
  }
}
  </script>
</head>

<body>
  
  <video id="player" controls autoplay></video>
<button id="capture">Capture</button>
<canvas id="snapshot" width=320 height=240></canvas>
  
  
  <script>
//    var video = document.getElementById("video");
//    var control = document.getElementById("control");
      var player = document.getElementById('player'); 
  var snapshotCanvas = document.getElementById('snapshot');
  var captureButton = document.getElementById('capture');

    getVideoSources(function(cam) {
      console.log("cam", cam);
      var b = document.createElement("input");
      b.type = "button";
      b.value = cam.name;
      b.onclick = getMain(cam.id);
      control.appendChild(b);
      console.log('add button');
    });

    function getMain(cam_id) {
      return function() {
        main(cam_id);
      };
    }

    function main(cam_id) {
      
      
      
        var handleSuccess = function(stream) {
    // Attach the video stream to the video element and autoplay.
    player.srcObject = stream;
  };
  captureButton.addEventListener('click', function() {
    var context = snapshot.getContext('2d');
    // Draw the video frame to the canvas.
    context.drawImage(player, 0, 0, snapshotCanvas.width, 
        snapshotCanvas.height);
  });
  navigator.mediaDevices.getUserMedia(audio: false,video: {
          optional: [
            { sourceId: cam_id}
          ]
        })
      .then(handleSuccess);

      
    };
  </script>
</body>

</html>
