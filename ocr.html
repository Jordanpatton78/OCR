<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
     <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no, shrink-to-fit=no" />
    <link rel="stylesheet" href="index.css" />
    <script src='https://cdn.rawgit.com/naptha/tesseract.js/1.0.7/dist/tesseract.js'></script>
    <script>
      window.addEventListener("load", function(){
        if (!window.File){
          result.innerHTML = "File API 使用不可";
          return;
        }
        document.getElementById("imageFile").addEventListener("change", function(){
          var reader = new FileReader();
          reader.onload = function(event){
            document.getElementById("image").src = reader.result;
          }
          var file = document.getElementById("imageFile").files[0];
          reader.readAsDataURL(file);
          try{
          var URL = window.URL || window.webkitURL;
          console.log(URL.createObjectURL(file))
          }catch(e){
          }
          Tesseract
            .recognize(URL.createObjectURL(file), {lang: 'jpn'})
            //.ImageLike('img', 'jpn')  //* browser only img || video || canvas
            .progress(function(p) {
              console.log('progress', p)
              document.write('progress', p.status+ " : " + p.progress )
            })
            .then(function(result) {
              console.log(result)
              document.write('<h1>' + result.text + '<h1>')
          });
        }, true);
      }, true);
    </script>
</head>

<video id="player" controls autoplay playsinline></video><br>
<body>
<button id="capture">　　　　　　　　　Capture　　　　　　　　　</button><br>
<canvas id="canvas"></canvas><br>
<br>
<br>
<br>
<br>
<br>
<canvas id="snapshot" width=300 height=100></canvas><br>
<div id="hoge">
</div>
<script>
var video  = document.getElementById("player"),
      canvas = document.getElementById("canvas"),
      ctx    = canvas.getContext("2d");
requestAnimationFrame(draw);
function draw() {
//canvas.width  = 400;
canvas.width  = window.innerWidth;
//canvas.height = 200;
canvas.height = window.innerHeight;
ctx.drawImage(video, 100, 300, 300, 100,
                     0, 0, 300, 100);

requestAnimationFrame(draw);
}
  var snapshotCanvas = document.getElementById('snapshot');
  var captureButton = document.getElementById('capture');

  var handleSuccess = function(stream) {
    // Attach the video stream to the video element and autoplay.
    video.srcObject = stream;
  };

  captureButton.addEventListener('click', function() {
    var context = snapshot.getContext('2d');
      
    // Draw the video frame to the canvas.
    context.drawImage(video,100, 300, 300, 100, 0, 0, snapshotCanvas.width, 
        snapshotCanvas.height);
      
          Tesseract
            .recognize(canvas.toDataURL("image/jpeg"), {lang: 'jpn'})
            //.ImageLike('img', 'jpn')  //* browser only img || video || canvas
            .progress(function(p) {
              console.log('progress', p)
              document.write('progress', p.status+ " : " + p.progress )
            })
            .then(function(result) {
              console.log(result)
              document.write('<h1>' + result.text + '<h1>')
          });
      
      
  });
var front = false;
var constraints = { video: 
{
optional: [
    {minWidth: 320},
    {minWidth: 640},
    {minWidth: 1024},
    {minWidth: 1280},
    {minWidth: 1920},
    {minWidth: 2560},
  ],
    facingMode: (front? "user" : "environment") } };
  navigator.mediaDevices.getUserMedia(constraints)
      .then(handleSuccess);
</script>
    
<form>
  <input type="file" accept="image/*;capture=camera" id="imageFile"/>
</form>
</body>
</html>
