<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no, shrink-to-fit=no, minimal-ui">
    <!-- meta name="apple-mobile-web-app-capable" content="yes" -->
    <link rel="stylesheet" href="index.css" />
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script src='https://cdn.rawgit.com/naptha/tesseract.js/1.0.7/dist/tesseract.js'></script>
    <script>
  (function () {
    Tesseract
      .recognize("u.jpg", {lang: 'jpn'})
      .progress(function(p) {
           $("#msg").text('Áî®ÊÑè„Å°„ÅÜüêπ:'+p.status+(100*p.progress).toFixed(1)+'%')
      })
      .then(function(result) {
        console.log(result)
           $("#msg").text('Ê∫ñÂÇôÂÆå‰∫Üüê∏')
      });
  }());
      window.addEventListener("load", function(){
        if (!window.File){
          result.innerHTML = "File API ‰ΩøÁî®‰∏çÂèØ";
          return;
        }
        document.getElementById("imageFile").addEventListener("change", function(){
          var reader = new FileReader();
          reader.onload = function(event){
            document.getElementById("image").src = reader.result;
          }
          var file = document.getElementById("imageFile").files[0];
          reader.readAsDataURL(file);
          try{
          var URL = window.URL || window.webkitURL;
          console.log(URL.createObjectURL(file))
          }catch(e){
          }
          Tesseract
            .recognize(URL.createObjectURL(file), {lang: 'jpn'})
            .progress(function(p) {
              console.log('progress', p)
                 $("#msg").text('progress'+ p.status+ " : " + p.progress )
              //document.write('progress', p.status+ " : " + p.progress )
            })
            .then(function(result) {
              console.log(result)
              //document.write('<h1>' + result.text + '<h1>')
                 $("#msg").text('<h1>' + result.text + '<h1>')
          });
        }, true);
      }, true);
    </script>
</head>
<video id="player" controls autoplay playsinline></video>
<body><br>
<div id='msg' align=center></div><br>
<div class="canvas"><canvas id="canvas" width=300 height=100></canvas><div><br>
<div class="button"><button id="captureeng">Capture(ENG)</button></div> 
<div class="button"><button id="capture">ÊíÆÂΩ±„Åô„Çã(Êó•Êú¨Ë™û)</button></div><br>
<canvas id="snapshot" width=300 height=100></canvas><br>
<div id="image-box"><img /></div>
<script>
var video  = document.getElementById("player"),
      canvas = document.getElementById("canvas"),
      ctx    = canvas.getContext("2d");
requestAnimationFrame(draw);
function draw() {
canvas.width  = 300;
canvas.height = 100;
//canvas.width  = window.innerWidth;
//canvas.height = window.innerHeight;
ctx.drawImage(video, 100, 300, 600, 200,
                     0, 0, 300, 100);
imgData = ctx.getImageData(0,0,canvas.width,canvas.height);
data=imgData.data;
for (let i = 0; i < data.length; i += 4) {
  ave = (data[i + 0] + data[i + 1] + data[i + 2]) / 3;
  data[i + 0] = 
  data[i + 1] = 
  data[i + 2] = (ave > 128) ? 255 :  0;
  data[i + 3] = 255;
}
ctx.putImageData(imgData, 0, 0);
requestAnimationFrame(draw);
}
  var snapshotCanvas = document.getElementById('snapshot');
  var captureButton = document.getElementById('capture');
  var captureButtoneng = document.getElementById('captureeng');
  var snapshotButton = document.getElementById('snapshotbutton');
  var handleSuccess = function(stream) {
    video.srcObject = stream;
  };
  captureButton.addEventListener('click', function() {
    var context = snapshot.getContext('2d');
    context.drawImage(video,100, 300, 600, 200, 0, 0, snapshotCanvas.width, 
        snapshotCanvas.height);
    const url=snapshot.toDataURL("image/jpeg");
    var elem=document.createElement('div');
    elem.innerHTML="<div><img src="+url+" /></div><br>"
    var parent=document.getElementById("results");
    parent.insertBefore(elem,parent.firstChild);
    var imgp=new Image();
    imgp.onload=function(){
      $("#image-box").children("img").attr({'src':url});
    }
    imgp.src=url;
          Tesseract
            //.recognize(canvas.toDataURL("image/jpeg"), {lang: 'jpn'})
            .recognize(url, {lang: 'jpn'})
            .progress(function(p) {
                 $("#msg").text('progress'+ p.status+ " : " + p.progress )
            })
            .then(function(result) {
              console.log(result)
              //document.write('<h1>' + result.text + '<h1>')
                 $("#msg").text('<h1>' + result.text + '<h1>')
            });
  });
  captureButtoneng.addEventListener('click', function() {
    var context = snapshot.getContext('2d');
    context.drawImage(video,100, 300, 600, 200, 0, 0, snapshotCanvas.width, 
        snapshotCanvas.height);
          Tesseract
            .recognize(snapshot.toDataURL("image/jpeg"), {lang: 'eng'})
            .progress(function(p) {
                 $("#msg").text('progress'+ p.status+ " : " + p.progress )
            })
            .then(function(result) {
              console.log(result)
                 $("#msg").text('<h1>' + result.text + '<h1>')
            });
  });
var front = false;
var constraints = {audio:false, video: 
{ width: 1280, height: 1280,
    facingMode: (front? "user" : "environment") } };
  navigator.mediaDevices.getUserMedia(constraints).then(handleSuccess);
</script>
</body>
<div id='results'></div>
</html>
